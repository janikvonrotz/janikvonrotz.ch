---
title: "2018 10 24 Setup GoCD server and agent using docker"
slug: 2018-10-24-setup-gocd-server-and-agent-using-docker
date: 2018-10-24T12:11:01+02:00
categories:
 - Blog
tags:
 - continuous delivery
 - gocd
 - introduction
 - docker
 - tutorial
image: /images/logo.png
draft: true
---

At [AdNovum](https://www.adnovum.ch/) we are running [GoCD](https://www.gocd.org/) for automating the continuous delivery (CD) of our software products. GoCD has become the de facto standard for running CD pipelines.

In this post I will give you a short introduction into GoCD using [docker](https://www.docker.com/). We are going to setup a GoCD environment composed of a server and an agent and further going to configure a deployment pipeline.

The server provides an interface for configuring pipelines, environments and agents. The agent does the actual work if a deployment pipeline is triggered. Workload is managed by GoCD server and can be shared among agents.

## GoCD environment

In order setup a GoCD environment you need [docker](https://www.docker.com/get-started).

If you are ready, start by downloading the official GoCD server image.

`docker pull gocd/gocd-server:v18.10.0`

Next start a new container.

`docker run -d -p8153:8153 -p8154:8154 gocd/gocd-server:v18.10.0`

In your browser open [https://localhost:8154](https://localhost:8154). In this interface you manage the GoCD server.

Before we create a pipeline we need an GoCD agent.

Pull the official gocd alpine image.

`docker pull gocd/gocd-agent-alpine-3.8:v18.10.0`

In order to connect the agent with the server, we need to know the server container name generated by docker.

docker ps --format '{{.Image}}: {{.Names}}'

Replace `_CONTAINER_NAME_` in the command below with the name shown above. Run the command to start a new GoCD agent container.

```
docker run -itd -e GO_SERVER_URL=https://$(docker inspect --format='{{(index (index .NetworkSettings.IPAddress))}}' _CONTAINER_NAME_):8154/go gocd/gocd-agent-alpine-3.8:v18.10.0
```

Make sure that server and agent have been successfully started.

docker ps

The agent is registering itself and should be displayed in the management interface.

[https://localhost:8154/go/agents#!/agentState/asc/](https://localhost:8154/go/agents#!/agentState/asc/)

# Pipeline configuration

Now we are ready to configure and run a GoCD pipeline. Every pipeline requires materials as input. A material is usually a git repository.

In the management interface create a new pipeline with the name `Example`.

Select *Git* as material type and enter this url: `https://github.com/gocd-contrib/getting-started-repo.git`

A pipeline passes a material and its resulting artifacts through multiple stages. Each stage performs a build procedure or check on the artifact. Here is an example of a 4-stage pipeline:

1. build
2. test
3. analyze
4. publish

Name the stage and job name *build*.

Select *More...* as task type and enter `./Build` in the command field.

Finish the wizard and unpause the pipeline.

## Troubleshooting

**Proxy**

In case the docker host runs behind a proxy and GoCD cannot connect to the git repository, make sure to configure the proxy environment variable when starting the docker container.

`docker run -e HTTPS_PROXY=https://_PROXY_HOST_:_PROXY_PORT_ ...`